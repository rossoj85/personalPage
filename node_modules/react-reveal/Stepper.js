"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(exports,"__esModule",{value:!0});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_Step=require("./Step"),_Step2=_interopRequireDefault(_Step),Stepper=function(){function t(){(0,_classCallCheck3.default)(this,t),this.steps=[],this.stepMap={},this.hasStarted=!1,this.isTriggered=!1,this.runs=1,this.totalRuns=0,this.start=this.start.bind(this),this.next=this.next.bind(this)}return(0,_createClass3.default)(t,[{key:"step",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,s=new _Step2.default(t,e);return s.start=this.start,s.index=this.steps.push(s)-1,this.stepMap[t]=s,this}},{key:"is",value:function(t){return this.get(t)}},{key:"get",value:function(t){if(t in this.stepMap)return this.stepMap[t];console.warn("Animation step "+t+" is missing")}},{key:"start",value:function(t){if(this.hasStarted&&(this.runs=2),this.isTriggered)return void(t<this.trigger&&(this.trigger=t));this.isTriggered=!0,this.trigger=t,window.setTimeout(this.init.bind(this),50)}},{key:"init",value:function(){this.hasStarted=!0,this.head=this.trigger,this.tail=0===this.head?this.steps.length-1:this.head-1,this.next()}},{key:"stop",value:function(){this.hasStarted=!1,this.isTriggered=!1}},{key:"next",value:function(){for(var t=!1,e=0,s=this.steps[this.head].chain.length;e<s;e++){var i=this.steps[this.head].chain[e];!i.isShown&&i.start&&i.inViewport()&&(t=!0,delete i.start,i.animate(i.props))}if(this.head===this.tail){if(this.runs--,++this.totalRuns>100)return;if(this.runs<=0)return this.stop()}var r=this.head;this.head++,this.head>=this.steps.length&&(this.head=0),t?window.setTimeout(this.next,this.steps[r].after):this.next()}}]),t}();exports.default=Stepper,module.exports=exports.default;